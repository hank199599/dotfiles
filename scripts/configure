#!/usr/bin/env bash

source utils

backup() {
  local target=$1
  if [[ -e "$target" ]]; then
    if [[ ! -L "$target" ]]; then
      local extension="backup.$(date +%Y%m%d%H%M%S)"
      mv "$target" "$target.$extension"
      info "Moved your old $target config file to $target.$extension"
    fi
  fi
}

symlink() {
  local file=$1
  local target=$2
  if [[ ! -f "$target" && ! -L "$target" ]]; then
    info "Symlinking your new $target"
    ln -s "$file" "$target"
  fi
}

info "Start to link .zshrc"
backup $HOME/.zshrc
symlink $PWD/configs/.zshrc $HOME/.zshrc

info "Start to link vscode settings & keybindings"
CODE_PATH=~/Library/Application\ Support/Code/User
for name in settings.json keybindings.json; do
  target="$CODE_PATH/$name"
  backup "$target"
  symlink "$PWD/configs/.vscode/$name" "$target"
done

exec zsh

success "Configure successful."
info "ðŸš€ Carry on with git setup. ðŸš€"
exit 0
